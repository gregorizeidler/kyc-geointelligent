<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KYC Geointelligent - Risk Analysis</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .risk-low { background-color: #d4edda; border-color: #c3e6cb; }
        .risk-medium { background-color: #fff3cd; border-color: #ffeaa7; }
        .risk-high { background-color: #f8d7da; border-color: #f5c6cb; }
        .loading-spinner { display: none; }
        .result-card { display: none; margin-top: 20px; }
        .feature-icon { font-size: 3rem; color: #0056b3; }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <div class="container">
            <a class="navbar-brand" href="#">
                <i class="fas fa-satellite-dish me-2"></i>
                KYC Geointelligent
            </a>
        </div>
    </nav>

    <div class="container mt-5">
        <!-- Hero Section -->
        <div class="row mb-5">
            <div class="col-lg-8 mx-auto text-center">
                <h1 class="display-4 fw-bold mb-3">KYC Geointelligent</h1>
                <p class="lead">AI-powered system for corporate client risk analysis using geospatial analysis and computer vision</p>
            </div>
        </div>

        <!-- Features Section -->
        <div class="row mb-5">
            <div class="col-md-4 text-center">
                <div class="feature-icon mb-3">
                    <i class="fas fa-map-marker-alt"></i>
                </div>
                <h4>Address Validation</h4>
                <p>Automatic address verification using OpenStreetMap and contextual analysis</p>
            </div>
            <div class="col-md-4 text-center">
                <div class="feature-icon mb-3">
                    <i class="fas fa-satellite"></i>
                </div>
                <h4>Satellite Analysis</h4>
                <p>AI-powered satellite image analysis to verify infrastructure and activity</p>
            </div>
            <div class="col-md-4 text-center">
                <div class="feature-icon mb-3">
                    <i class="fas fa-chart-line"></i>
                </div>
                <h4>Risk Scoring</h4>
                <p>Automatic risk score generation with actionable recommendations</p>
            </div>
        </div>

        <!-- KYC Analysis Form -->
        <div class="row">
            <div class="col-lg-8 mx-auto">
                <div class="card shadow">
                    <div class="card-header bg-primary text-white">
                        <h3 class="card-title mb-0">
                            <i class="fas fa-search me-2"></i>
                            KYC Analysis
                        </h3>
                    </div>
                    <div class="card-body">
                        <form id="kycForm">
                            <div class="mb-3">
                                <label for="cnpj" class="form-label">Company CNPJ</label>
                                <input type="text" class="form-control" id="cnpj" placeholder="XX.XXX.XXX/XXXX-XX" required>
                            </div>
                            
                            <div class="mb-3">
                                <label for="address" class="form-label">Complete Address</label>
                                <textarea class="form-control" id="address" rows="2" placeholder="Street, number, neighborhood, city, state" required></textarea>
                            </div>
                            
                            <div class="mb-3">
                                <label for="businessType" class="form-label">Business Type</label>
                                <select class="form-select" id="businessType" required>
                                    <option value="">Select business type</option>
                                    <option value="Logistics">Logistics</option>
                                    <option value="Manufacturing">Manufacturing</option>
                                    <option value="Technology">Technology</option>
                                    <option value="Consulting">Consulting</option>
                                    <option value="Retail">Retail</option>
                                    <option value="Construction">Construction</option>
                                    <option value="Transport">Transport</option>
                                </select>
                            </div>
                            
                            <div class="mb-3">
                                <label for="declaredActivity" class="form-label">Declared Activity</label>
                                <input type="text" class="form-control" id="declaredActivity" placeholder="e.g., Road freight transport" required>
                            </div>
                            
                            <div class="d-grid">
                                <button type="submit" class="btn btn-primary btn-lg">
                                    <i class="fas fa-play me-2"></i>
                                    Start Analysis
                                </button>
                            </div>
                        </form>
                        
                        <!-- Loading Spinner -->
                        <div class="loading-spinner text-center">
                            <div class="spinner-border text-primary" role="status">
                                <span class="visually-hidden">Analyzing...</span>
                            </div>
                            <p class="mt-2">Analyzing data... This process may take up to 30 seconds.</p>
                        </div>
                    </div>
                </div>

                <!-- Results Card -->
                <div class="result-card">
                    <div class="card shadow mt-4">
                        <div class="card-header" id="resultHeader">
                            <h4 class="mb-0">Analysis Result</h4>
                        </div>
                        <div class="card-body" id="resultBody">
                            <!-- Results will be inserted here -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- API Documentation -->
        <div class="row mt-5">
            <div class="col-lg-8 mx-auto">
                <div class="card">
                    <div class="card-header">
                        <h4>API Integration</h4>
                    </div>
                    <div class="card-body">
                        <p>This system can be integrated into your existing applications via REST API:</p>
                        <ul>
                            <li><strong>POST /api/kyc/analyze</strong> - Individual analysis</li>
                            <li><strong>POST /api/kyc/batch</strong> - Batch analysis (up to 10 companies)</li>
                            <li><strong>GET /health</strong> - System status</li>
                        </ul>
                        <p>See complete documentation at <code>/api/documentation</code></p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <footer class="bg-light mt-5 py-4">
        <div class="container text-center">
            <p class="text-muted mb-0">Â© 2024 KYC Geointelligent - Risk analysis system for corporate clients</p>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        document.getElementById('kycForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            // Show loading spinner
            document.querySelector('.loading-spinner').style.display = 'block';
            document.querySelector('.result-card').style.display = 'none';
            
            // Collect form data
            const formData = {
                cnpj: document.getElementById('cnpj').value,
                address: document.getElementById('address').value,
                business_type: document.getElementById('businessType').value,
                declared_activity: document.getElementById('declaredActivity').value
            };
            
            try {
                // Make API request
                const response = await fetch('/api/kyc/analyze', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(formData)
                });
                
                const result = await response.json();
                
                // Hide loading spinner
                document.querySelector('.loading-spinner').style.display = 'none';
                
                // Display results
                displayResults(result);
                
            } catch (error) {
                console.error('Error:', error);
                document.querySelector('.loading-spinner').style.display = 'none';
                alert('Analysis error. Please try again.');
            }
        });
        
        function displayResults(result) {
            const resultCard = document.querySelector('.result-card');
            const resultHeader = document.getElementById('resultHeader');
            const resultBody = document.getElementById('resultBody');
            
            // Determine risk level styling
            let headerClass = 'bg-secondary';
            let riskIcon = 'fas fa-question-circle';
            
            if (result.risk_level === 'LOW') {
                headerClass = 'bg-success text-white';
                riskIcon = 'fas fa-check-circle';
            } else if (result.risk_level === 'MEDIUM') {
                headerClass = 'bg-warning text-dark';
                riskIcon = 'fas fa-exclamation-triangle';
            } else if (result.risk_level === 'HIGH') {
                headerClass = 'bg-danger text-white';
                riskIcon = 'fas fa-times-circle';
            }
            
            resultHeader.className = `card-header ${headerClass}`;
            resultHeader.innerHTML = `
                <h4 class="mb-0">
                    <i class="${riskIcon} me-2"></i>
                    Risk Level: ${result.risk_level || 'UNKNOWN'}
                </h4>
            `;
            
            let factorsList = '';
            if (result.risk_factors && result.risk_factors.length > 0) {
                factorsList = '<ul>' + result.risk_factors.map(factor => `<li>${factor}</li>`).join('') + '</ul>';
            }
            
            let positivesList = '';
            if (result.positive_factors && result.positive_factors.length > 0) {
                positivesList = '<ul>' + result.positive_factors.map(factor => `<li>${factor}</li>`).join('') + '</ul>';
            }
            
            resultBody.innerHTML = `
                <div class="row">
                    <div class="col-md-6">
                        <h5>Risk Score</h5>
                        <div class="progress mb-3">
                            <div class="progress-bar ${getProgressBarClass(result.risk_level)}" 
                                 role="progressbar" 
                                 style="width: ${(result.overall_risk_score || 0) * 100}%">
                                ${((result.overall_risk_score || 0) * 100).toFixed(1)}%
                            </div>
                        </div>
                        
                        <h5>Recommendation</h5>
                        <p class="fw-bold">${result.recommendation || 'MANUAL_REVIEW'}</p>
                        
                        <h5>Analysis Confidence</h5>
                        <div class="progress mb-3">
                            <div class="progress-bar bg-info" 
                                 role="progressbar" 
                                 style="width: ${(result.confidence_level || 0) * 100}%">
                                ${((result.confidence_level || 0) * 100).toFixed(1)}%
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-6">
                        <h5>Processing Time</h5>
                        <p>${result.processing_time_seconds || 0} seconds</p>
                        
                        <h5>Analysis ID</h5>
                        <p><small class="text-muted">${result.request_id || 'N/A'}</small></p>
                    </div>
                </div>
                
                <hr>
                
                <div class="alert alert-info">
                    <strong>Detailed Assessment:</strong><br>
                    ${result.recommendation_text || 'Analysis not available.'}
                </div>
                
                ${result.risk_factors && result.risk_factors.length > 0 ? `
                    <h5 class="text-danger">Risk Factors Identified</h5>
                    ${factorsList}
                ` : ''}
                
                ${result.positive_factors && result.positive_factors.length > 0 ? `
                    <h5 class="text-success">Positive Factors</h5>
                    ${positivesList}
                ` : ''}
                
                ${result.error ? `
                    <div class="alert alert-danger mt-3">
                        <strong>Error:</strong> ${result.error}
                    </div>
                ` : ''}
            `;
            
            resultCard.style.display = 'block';
            resultCard.scrollIntoView({ behavior: 'smooth' });
        }
        
        function getProgressBarClass(riskLevel) {
            switch(riskLevel) {
                case 'LOW': return 'bg-success';
                case 'MEDIUM': return 'bg-warning';
                case 'HIGH': return 'bg-danger';
                default: return 'bg-secondary';
            }
        }
        
        // CNPJ formatting
        document.getElementById('cnpj').addEventListener('input', function(e) {
            let value = e.target.value.replace(/\D/g, '');
            if (value.length <= 14) {
                value = value.replace(/(\d{2})(\d)/, '$1.$2');
                value = value.replace(/(\d{3})(\d)/, '$1.$2');
                value = value.replace(/(\d{3})(\d)/, '$1/$2');
                value = value.replace(/(\d{4})(\d)/, '$1-$2');
                e.target.value = value;
            }
        });
    </script>
</body>
</html>